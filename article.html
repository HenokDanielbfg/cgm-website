<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Article — CGM</title>

  <style>
    :root{
      --bg:#0b0c0f; --text:#f3f0e6; --muted:#c9c3b1;
      --gold:#d4af37; --gold2:#e8d9a8; --gold3:#b88a1a;
      --border: rgba(212,175,55,.28);
      --shadow: 0 18px 50px rgba(0,0,0,.55);
      --radius: 22px;
      --max: 980px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      color:var(--text);
      background:
        radial-gradient(900px 520px at 10% 0%, rgba(212,175,55,.09), transparent 55%),
        radial-gradient(850px 520px at 100% 10%, rgba(232,217,168,.06), transparent 55%),
        linear-gradient(180deg, #07080b 0%, var(--bg) 30%, #07080b 100%);
      font: 16px/1.8 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      letter-spacing:.2px;
    }
    .wrap{ width:min(var(--max), calc(100% - 48px)); margin:0 auto; padding: 44px 0 70px; }
    .serif{ font-family: ui-serif, Georgia, Cambria, "Times New Roman", Times, serif; letter-spacing:.3px; }
    a{ color: var(--gold2); text-decoration:none; border-bottom: 1px dashed rgba(232,217,168,.35); }
    a:hover{ border-bottom-color: rgba(232,217,168,.85); }
    .card{
      background: linear-gradient(180deg, rgba(15,17,24,.92), rgba(10,12,18,.92));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 26px;
      position: relative;
      overflow:hidden;
    }
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding: 6px 10px; border-radius: 999px;
      border: 1px solid rgba(212,175,55,.20);
      background: rgba(212,175,55,.06);
      color: var(--gold2); font-size: 12px;
      margin-bottom: 14px;
      white-space: nowrap;
    }
    h1{ margin:0 0 10px; line-height:1.15; font-size: clamp(30px, 4vw, 46px); }
    .meta{ color: var(--muted); font-size: 13px; margin-bottom: 18px; }
    .back{
      display:inline-flex; align-items:center; gap:10px;
      margin-bottom: 16px;
      padding: 10px 14px;
      border-radius: 14px;
      border: 1px solid rgba(212,175,55,.30);
      background: rgba(212,175,55,.06);
      color: var(--text);
      text-decoration:none;
    }
    .back:hover{ background: rgba(212,175,55,.10); }
    /* Markdown render styling */
    #content p{ margin: 0 0 14px; color: #d9d2c0; }
    #content h2, #content h3{
      margin: 22px 0 10px;
      line-height:1.2;
    }
    #content h2{ font-size: 26px; }
    #content h3{ font-size: 20px; }
    #content ul{ margin: 0 0 14px 22px; color:#d9d2c0; }
    #content li{ margin: 6px 0; }
    #content blockquote{
      margin: 16px 0;
      padding: 14px 16px;
      border-left: 3px solid rgba(212,175,55,.55);
      background: rgba(212,175,55,.05);
      border-radius: 14px;
      color:#e3dece;
    }
    #content hr{
      border:0; height:1px;
      background: linear-gradient(90deg, transparent, rgba(212,175,55,.35), transparent);
      margin: 18px 0;
    }
    code{
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(212,175,55,.18);
      padding: 2px 6px;
      border-radius: 10px;
      color: var(--gold2);
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size: 13px;
    }
    pre{
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(212,175,55,.18);
      padding: 14px;
      border-radius: 16px;
      overflow:auto;
    }
    pre code{ padding:0; border:0; background:transparent; color:#e3dece; }
  </style>
</head>
<body>
  <div class="wrap">
    <a class="back" href="index.html#articles">← Back to Articles</a>

    <div class="card">
      <div class="pill" id="tag">Article</div>
      <h1 class="serif" id="title">Loading...</h1>
      <div class="meta" id="meta"></div>
      <div id="content"></div>
    </div>
  </div>

  <script>
    function getParam(name){
      return new URLSearchParams(location.search).get(name);
    }

    function escapeHtml(s){
      return String(s ?? "").replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    function formatDate(iso){
      const d = new Date((iso || "") + "T00:00:00");
      if (isNaN(d.getTime())) return "";
      return d.toLocaleDateString(undefined, { year:"numeric", month:"short", day:"2-digit" });
    }

    // Minimal Markdown -> HTML (no external libraries)
    function mdToHtml(md){
      const lines = String(md || "").replace(/\r\n/g,"\n").split("\n");
      let html = "";
      let inList = false;
      let inCode = false;
      let codeLang = "";

      function closeList(){
        if(inList){ html += "</ul>"; inList = false; }
      }

      for(let i=0;i<lines.length;i++){
        let line = lines[i];

        // fenced code ```lang
        const fence = line.match(/^```(\w+)?\s*$/);
        if(fence){
          if(!inCode){
            closeList();
            inCode = true;
            codeLang = fence[1] || "";
            html += "<pre><code>";
          }else{
            inCode = false;
            html += "</code></pre>";
          }
          continue;
        }

        if(inCode){
          html += escapeHtml(line) + "\n";
          continue;
        }

        // hr
        if(/^---\s*$/.test(line)){
          closeList();
          html += "<hr>";
          continue;
        }

        // headings
        const h2 = line.match(/^##\s+(.*)$/);
        if(h2){ closeList(); html += `<h2 class="serif">${escapeHtml(h2[1])}</h2>`; continue; }
        const h3 = line.match(/^###\s+(.*)$/);
        if(h3){ closeList(); html += `<h3 class="serif">${escapeHtml(h3[1])}</h3>`; continue; }

        // blockquote
        const bq = line.match(/^>\s?(.*)$/);
        if(bq){
          closeList();
          html += `<blockquote>${escapeHtml(bq[1])}</blockquote>`;
          continue;
        }

        // list items
        const li = line.match(/^\-\s+(.*)$/);
        if(li){
          if(!inList){ html += "<ul>"; inList = true; }
          html += `<li>${escapeHtml(li[1])}</li>`;
          continue;
        } else {
          closeList();
        }

        // blank
        if(line.trim() === ""){
          continue;
        }

        // inline bold/italic (very light)
        let safe = escapeHtml(line)
          .replace(/\*\*(.+?)\*\*/g, "<b>$1</b>")
          .replace(/\*(.+?)\*/g, "<i>$1</i>")
          .replace(/`(.+?)`/g, "<code>$1</code>");

        // links [text](url)
        safe = safe.replace(/\[([^\]]+)\]\((https?:\/\/[^\)]+)\)/g, `<a href="$2" target="_blank" rel="noreferrer">$1</a>`);

        html += `<p>${safe}</p>`;
      }

      if(inList) html += "</ul>";
      if(inCode) html += "</code></pre>";
      return html;
    }

    const id = getParam("id");
    if(!id){
      document.getElementById("title").textContent = "Article not found";
      document.getElementById("content").innerHTML = "<p>Missing article id.</p>";
    } else {
      fetch("articles.json")
        .then(r => r.json())
        .then(items => {
          const a = items.find(x => x.id === id);
          if(!a){
            document.getElementById("title").textContent = "Article not found";
            document.getElementById("content").innerHTML = "<p>This article does not exist.</p>";
            return;
          }

          document.title = (a.title || "Article") + " — CGM";
          document.getElementById("title").textContent = a.title || "Untitled";
          document.getElementById("tag").textContent = a.tag || "Article";
          document.getElementById("meta").textContent = a.date ? formatDate(a.date) + " • Christ Generation Ministry" : "Christ Generation Ministry";

          return fetch(a.md).then(r => r.text()).then(md => {
            document.getElementById("content").innerHTML = mdToHtml(md);
          });
        })
        .catch(err => {
          console.error(err);
          document.getElementById("title").textContent = "Error loading article";
          document.getElementById("content").innerHTML = "<p>Unable to load article content.</p>";
        });
    }
  </script>
</body>
</html>